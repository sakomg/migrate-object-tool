<template>
  <div class="container">
    <div if:true={loadingObj.main}>
      <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
      <img src="/img/chatter/Desert.svg" class="illustration-onloading" alt="Desert" />
    </div>

    <div if:false={loadingObj.main}>
      <header class="slds-theme_default slds-border_bottom slds-p-around_small" style="z-index: 1">
        <lightning-button-icon-stateful
          icon-name="utility:toggle_panel_left"
          alternative-text="panel-left"
          selected={openPanelLeft}
          variant="brand"
          onclick={handleTogglePanelLeft}
        ></lightning-button-icon-stateful>
      </header>
      <div style="background-color: #fafaf9; position: relative; overflow: hidden; display: flex">
        <template if:true={openPanelLeft}>
          <div
            class="slds-panel slds-size_medium slds-panel_docked slds-panel_docked-left slds-panel_drawer slds-is-open"
            aria-hidden="false"
          >
            <div class="slds-panel__header">
              <h2 class="slds-panel__header-title slds-text-heading_small slds-truncate" title="Panel Header">Panel Header</h2>
              <div class="slds-panel__header-actions">
                <lightning-button-icon
                  icon-name="utility:close"
                  size="small"
                  variant="base"
                  onclick={handleTogglePanelLeft}
                ></lightning-button-icon>
              </div>
            </div>
            <div class="slds-panel__body">
              <div>
                <c-migrate-object-tool-batch-progress></c-migrate-object-tool-batch-progress>
              </div>
            </div>
          </div>
        </template>
        <div class="slds-col slds-p-around_medium">
          <lightning-accordion class="container-accordion" allow-multiple-sections-open active-section-name={activeSections}>
            <lightning-accordion-section name="step-1" label="Step 1">
              <div id="step-1">
                <div>
                  <i>Choose objects to transfer data.</i>
                </div>
                <div class="pair-container">
                  <div class="pair">
                    <div class="drop-icon"></div>
                    <c-combobox
                      name="sObject"
                      label="From Object"
                      value=""
                      placeholder="Choose sObject"
                      options={sObjectNameOptions}
                      onchange={handleSObjectChange}
                    >
                    </c-combobox>
                    <c-combobox
                      name="bObject"
                      label="To Object"
                      value=""
                      placeholder="Choose Big Object"
                      options={bigObjectNameOptions}
                      onchange={handleBigObjectChange}
                    >
                    </c-combobox>
                    <div class="delete-icon"></div>
                  </div>
                </div>
              </div>
            </lightning-accordion-section>

            <lightning-accordion-section name="step-2" label="Step 2" class="slds-is-relative">
              <div id="step-2">
                <div if:true={loadingObj.step2}>
                  <lightning-spinner alternative-text="Loading..." size="small"></lightning-spinner>
                </div>
                <div>
                  <i>Choose fields to transfer data.</i>
                </div>
                <div class="pair-container">
                  <div class="pair">
                    <div class="drop-icon"></div>
                    <p>From Field</p>
                    <p>To Field</p>
                    <div class="delete-icon"></div>
                  </div>

                  <template for:each={fieldPairs} for:item="pair" for:index="idx">
                    <div
                      draggable="true"
                      class="drag"
                      key={pair.index}
                      ondragstart={drag.start}
                      ondragover={drag.over}
                      ondragend={handleDragEnd}
                      data-index={idx}
                    >
                      <c-migrate-object-tool-field-pair
                        pair={pair}
                        so-field-options={soFieldOptions}
                        bo-field-options={boFieldOptions}
                        onfieldchange={handleObjectFieldChange}
                        ondeletepair={handleDeleteIconClick}
                      ></c-migrate-object-tool-field-pair>
                    </div>
                  </template>
                </div>
              </div>
            </lightning-accordion-section>

            <lightning-accordion-section name="step-3" label="Step 3" class="slds-is-relative">
              <div id="step-3">
                <div if:true={loadingObj.step3}>
                  <lightning-spinner alternative-text="Loading..." size="small"></lightning-spinner>
                </div>
                <div>
                  <i>Conditions to fetch Custom Object records.</i>
                </div>
                <div class="pair-container">
                  <div class="pair">
                    <div class="drop-icon"></div>
                    <div class="condition-container">
                      <lightning-textarea
                        label="Salesforce Object Query Language (SOQL)"
                        onchange={handleInputUserQuery}
                        value={conditionQueryValue}
                        placeholder="Enter query"
                      ></lightning-textarea>
                      <div class={styleAfterQuery}>{messageAfterQuery}</div>
                    </div>
                    <div class="delete-icon"></div>
                  </div>
                </div>
              </div>
            </lightning-accordion-section>

            <lightning-accordion-section name="step-4" label="Step 4">
              <div id="step-4">
                <div>
                  <i>Migration Recurrence.</i>
                </div>
                <div>
                  <c-migrate-object-tool-recurrence></c-migrate-object-tool-recurrence>
                </div>
              </div>
            </lightning-accordion-section>
          </lightning-accordion>
        </div>
      </div>
    </div>
  </div>
</template>
